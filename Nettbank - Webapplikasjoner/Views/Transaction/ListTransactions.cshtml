@model List<Nettbank___Webapplikasjoner.Models.Transaction>

@{
    ViewBag.Title = "Betalingsoversikt";
}

<script type="text/javascript">
    $(document).ready(function() {
            // lag en hendelse som utføres når en a-href med "data-SletteModal = true" trykkes.
            $('a[data-deleteModal=true]').click(function() {

                    // hent inn data-taggene fra denne a-hef lenken
                    var data_navn = $(this).data('navn');
                    var data_id = $(this).data('id');

                    // legg ut dataene i div'en i modal-view'et
                    $('#deleteTransaction').html(data_navn);

                    $("#deleteModalButton").click(function () {
                        // id som skal slettes ligger i data_id
                        $.ajax({
                            url: '@Url.Action("Delete", "Transaction")',
                            data: { id: data_id },  // en parameter inn i slett(id)-metoden i kunde-kontrolleren (JSON-objekt)
                            success: function () {
                                // må kalle liste-metoden for å vise den nye listen av kunder
                                $.ajax({
                                    url: '@Url.Action("ListTransactions", "Transaction")',
                                    success: function () {
                                        // så må siden reloades!
                                        window.location.reload();
                                    }
                                });
                            }
                        });
                    })
                })
        });
</script>
<div class="row">
    <div class="col-sm-7">
        <h1>
            Betalingsoversikt
            <small>???? ?? ?????</small>
        </h1>
    </div>
    <div class="col-sm-5">
        @Html.DropDownList("AccountList", ViewBag.AccountList as IEnumerable<SelectListItem>, new { @class = "form-control", @id = "account-dropdown"})
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-body">
        <table class="table">
            <tr>
                <th class="col-md-2">@Html.DisplayNameFor(model => model[0].toAccountNumber)</th>
                <th class="col-md-1">@Html.DisplayNameFor(model => model[0].amount)</th>
                <th class="col-md-2">@Html.DisplayNameFor(model => model[0].timeToBeTransfered)</th>
                <th class="col-md-5">@Html.DisplayNameFor(model => model[0].comment)</th>
                <th class="col-md-2"></th>
            </tr>
            @foreach (var item in Model) {
                <tr>
                    <td>@Int64.Parse(item.toAccountNumber).ToString("0000 00 00000")</td>
                    <td style="text-align: right">@item.amount kr</td>
                    <td>@item.timeToBeTransfered.Value.ToShortDateString()</td>
                    <td style="text-align: left">@item.comment</td>
                    <td>
                        <a href="#deleteModal" class="btn btn-xs btn-danger" id="deleteButton"
                           data-navn="Beløp: @item.amount, Fra konto: @item.fromAccountNumber, Til konto: @item.toAccountNumber"
                           data-id="@item.transactionId" data-toggle="modal" data-deleteModal="true">Slett</a>
                        @Html.ActionLink(linkText: "Endre", actionName: "UpdateTransaction", controllerName: "Transaction", routeValues: new { id = item.transactionId }, htmlAttributes: new { @class = "btn btn-xs btn-info" })
                    </td>
                </tr>
            }
            @Html.Partial("deleteModal")
        </table>
    </div>
</div>